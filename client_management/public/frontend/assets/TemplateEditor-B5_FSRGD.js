var T=(q,x,r)=>new Promise((k,t)=>{var y=o=>{try{p(r.next(o))}catch(f){t(f)}},_=o=>{try{p(r.throw(o))}catch(f){t(f)}},p=o=>o.done?k(o.value):Promise.resolve(o.value).then(y,_);p((r=r.apply(q,x)).next())});import{h as B,r as v,q as L,c as I,a as i,i as c,t as C,b as h,d,u as n,F as M,k as W,w,j,a9 as z,e as A,o as m,I as b,g as V,l as U,m as O,n as N,p as G}from"./index-CK1KYSDl.js";const H={class:"max-w-3xl mx-auto p-6"},J={key:0,class:"text-center py-8"},K={key:1,class:"mb-4 p-4 bg-red-100 text-red-700 rounded-md"},Q={key:2,class:"mb-4 p-4 bg-green-100 text-green-700 rounded-md"},X={key:3,class:"card"},Y={key:0,class:"absolute top-2 right-2"},Z={class:"card-header"},ee={class:"card-body"},ae={key:0,class:"mb-4"},te={key:1,class:"mb-4"},le={class:"grid grid-cols-2 gap-4 mb-4"},se={class:"flex gap-3"},oe={__name:"TemplateEditor",setup(q){const x=z(),r=A(),k=v(x.params.name),t=v({template_name:"",tasks:[]}),y=v(!0),_=v(!1),p=v(!1),o=v("");L(()=>T(this,null,function*(){yield f()}));const f=()=>T(this,null,function*(){y.value=!0;try{const s=yield I({url:"frappe.client.get",params:{doctype:"Template",name:k.value,fields:["*"],fields:["name","template_name","tasks.task_name","tasks.task_type","tasks.complete_within_days","tasks.from_date","tasks.to_date","tasks.description","tasks.is_child","tasks.parent_task","tasks.name"]}}).fetch();t.value={template_name:s.template_name,tasks:s.tasks.map((e,u,a)=>({name:e.name,task_name:e.task_name,task_type:e.task_type,complete_within_days:e.complete_within_days,from_date:e.from_date,to_date:e.to_date,description:e.description,is_child:!!e.parent_task,parent_task:e.parent_task?a.findIndex(g=>g.name===e.parent_task):null}))},t.value.tasks.length===0&&t.value.tasks.push(D())}catch(l){o.value=l.message||"Failed to load template data"}finally{y.value=!1}}),D=()=>({name:"",task_name:"",task_type:"",complete_within_days:1,from_date:"",to_date:"",description:"",is_child:!1,parent_task:null}),S=()=>{t.value.tasks.push(D())},$=l=>{t.value.tasks.splice(l,1)},F=l=>{l.is_child&&(l.from_date="",l.to_date="",l.parent_task=null)},E=l=>t.value.tasks.slice(0,l),P=()=>T(this,null,function*(){_.value=!0,p.value=!1,o.value="";try{const l=t.value.tasks.map((e,u)=>{const a={task_name:e.task_name,task_type:e.task_type,complete_within_days:e.complete_within_days,description:e.description,is_child:e.is_child||!1,parent_index:e.is_child?parseInt(e.parent_task):null};return e.is_child||(a.from_date=e.from_date,a.to_date=e.to_date),a});yield I({url:"client_management.client_management.doctype.template.template.update_template_with_task",method:"POST",params:{template_name:k.value,new_template_name:t.value.template_name,tasks:l}}).submit(),p.value=!0,setTimeout(()=>{r.push({name:"TemplateList"})},1500)}catch(l){o.value=l.message||"Failed to update template"}finally{_.value=!1}}),R=()=>{r.go(-1)};return(l,s)=>(m(),i("div",H,[y.value&&!t.value.template_name?(m(),i("div",J," Loading template data... ")):c("",!0),o.value?(m(),i("div",K,C(o.value),1)):c("",!0),p.value?(m(),i("div",Q," Template updated successfully! ")):c("",!0),t.value.template_name?(m(),i("div",X,[s[5]||(s[5]=h("h2",{class:"card-header"},"Edit Template",-1)),h("form",{onSubmit:j(P,["prevent"]),class:"card-body"},[d(n(b),{label:"Template Name",modelValue:t.value.template_name,"onUpdate:modelValue":s[0]||(s[0]=e=>t.value.template_name=e),type:"text",required:"",class:"mb-4"},null,8,["modelValue"]),(m(!0),i(M,null,W(t.value.tasks,(e,u)=>(m(),i("div",{key:u,class:"card mb-4 relative"},[u>0?(m(),i("div",Y,[d(n(U),{onClick:a=>$(u),variant:"ghost",size:"sm"},{default:w(()=>s[1]||(s[1]=[V(" Remove ")])),_:2,__:[1]},1032,["onClick"])])):c("",!0),h("h3",Z,"Task "+C(u+1),1),h("div",ee,[s[2]||(s[2]=V(" < ")),u>0?(m(),i("div",ae,[d(n(O),{modelValue:e.is_child,"onUpdate:modelValue":a=>e.is_child=a,onChange:a=>F(e),label:"Is Child Task"},null,8,["modelValue","onUpdate:modelValue","onChange"])])):c("",!0),e.is_child?(m(),i("div",te,[d(n(N),{modelValue:e.parent_task,"onUpdate:modelValue":a=>e.parent_task=a,options:[{label:"Select Parent Task",value:""},...E(u).map((a,g)=>({label:a.task_name||`Task ${g+1}`,value:g}))],label:"Parent Task",required:""},null,8,["modelValue","onUpdate:modelValue","options"])])):c("",!0),d(n(b),{label:"Task Name",modelValue:e.task_name,"onUpdate:modelValue":a=>e.task_name=a,type:"text",required:"",class:"mb-4"},null,8,["modelValue","onUpdate:modelValue"]),d(n(N),{modelValue:e.task_type,"onUpdate:modelValue":a=>e.task_type=a,options:[{label:"Select Task Type",value:""},{label:"Internal",value:"Internal"},{label:"Client",value:"Client"}],required:"",class:"mb-4"},null,8,["modelValue","onUpdate:modelValue"]),d(n(b),{label:"Complete Within Days",modelValue:e.complete_within_days,"onUpdate:modelValue":a=>e.complete_within_days=a,type:"number",min:"1",required:"",class:"mb-4"},null,8,["modelValue","onUpdate:modelValue"]),h("div",le,[d(n(b),{label:"From Date",modelValue:e.from_date,"onUpdate:modelValue":a=>e.from_date=a,type:"date",disabled:e.is_child,required:!e.is_child},null,8,["modelValue","onUpdate:modelValue","disabled","required"]),d(n(b),{label:"To Date",modelValue:e.to_date,"onUpdate:modelValue":a=>e.to_date=a,type:"date",disabled:e.is_child,required:!e.is_child},null,8,["modelValue","onUpdate:modelValue","disabled","required"])]),d(n(G),{label:"Description",modelValue:e.description,"onUpdate:modelValue":a=>e.description=a,rows:"3"},null,8,["modelValue","onUpdate:modelValue"])])]))),128)),d(n(U),{type:"button",onClick:S,variant:"outline",class:"w-full mb-4"},{default:w(()=>s[3]||(s[3]=[V(" + Add Task ")])),_:1,__:[3]}),h("div",se,[d(n(U),{type:"button",onClick:R,variant:"outline",class:"flex-1",disabled:_.value},{default:w(()=>s[4]||(s[4]=[V(" Cancel ")])),_:1,__:[4]},8,["disabled"]),d(n(U),{type:"submit",variant:"solid",theme:"gray",class:"flex-1",loading:_.value},{default:w(()=>[V(C(_.value?"Updating...":"Update Template"),1)]),_:1},8,["loading"])])],32)])):c("",!0)]))}},ie=B(oe,[["__scopeId","data-v-41b928dd"]]);export{ie as default};
//# sourceMappingURL=TemplateEditor-B5_FSRGD.js.map
