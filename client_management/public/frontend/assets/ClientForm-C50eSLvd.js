var ee=Object.defineProperty,te=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var V=(b,d,o)=>d in b?ee(b,d,{enumerable:!0,configurable:!0,writable:!0,value:o}):b[d]=o,L=(b,d)=>{for(var o in d||(d={}))ae.call(d,o)&&V(b,o,d[o]);if(R)for(var o of R(d))ne.call(d,o)&&V(b,o,d[o]);return b},z=(b,d)=>te(b,se(d));var x=(b,d,o)=>new Promise((p,y)=>{var h=g=>{try{N(o.next(g))}catch(w){y(w)}},j=g=>{try{N(o.throw(g))}catch(w){y(w)}},N=g=>g.done?p(g.value):Promise.resolve(g.value).then(h,j);N((o=o.apply(b,d)).next())});import{h as oe,r as _,aa as le,A as M,a6 as re,q as ie,a as u,b as t,j as de,d as ce,u as I,F as C,k as D,Z as me,w as ue,i as B,t as i,a2 as O,g as v,e as pe,U as fe,o as c,ab as ve,ac as ge}from"./index-CK1KYSDl.js";const be={class:"container mx-auto px-4 py-8"},we={class:"grid grid-cols-1 lg:grid-cols-8 gap-8 mb-8"},_e={class:"lg:col-span-8"},ye={class:"bg-white p-6 shadow-md rounded-md"},he={class:"flex"},xe=["value"],ke=["value"],Ce={class:"grid grid-cols-1 lg:grid-cols-8 gap-8"},Ne={class:"lg:col-span-8"},$e={class:"bg-white p-6 shadow-md rounded-md"},Se={class:"overflow-x-auto"},Ee={class:"min-w-full bg-white border border-gray-200 rounded-lg"},De={class:"py-3 px-4 border-b"},Me={class:"py-3 px-4 border-b"},je={class:"py-3 px-4 border-b"},Fe={class:"py-3 px-4 border-b"},Te={class:"flex space-x-2"},Be=["onClick"],Pe=["onClick"],Ue=["onClick"],Ae={key:0},Re={class:"flex items-center justify-between mt-4"},Ve={class:"text-sm text-gray-500"},Le={class:"flex space-x-2"},ze=["disabled"],Ie=["disabled"],Oe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ge={class:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-auto"},He={class:"mb-6"},qe={class:"mb-6"},Je={key:0,class:"space-y-4"},Xe={key:1},Ye={class:"mb-6"},Ze={key:0,class:"space-y-4"},Ke={key:1},Qe={__name:"ClientForm",setup(b){const d=_([]),o=_([]),p=_(1),y=_(10),h=_([]),j=_(!1),N=pe(),g=le({client_name:"",contact_person:[],selected_users:[]}),w=_(""),k=_(""),S=_(null),E=_(null),P=a=>{if(!a)return"Unknown date";try{const e=new Date(a);if(isNaN(e.getTime()))return a;const l=String(e.getDate()).padStart(2,"0"),r=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear(),m=String(e.getHours()).padStart(2,"0"),n=String(e.getMinutes()).padStart(2,"0"),f=String(e.getSeconds()).padStart(2,"0");return`${l}-${r}-${s} ${m}:${n}:${f}`}catch(e){return console.error("Error formatting date:",e),a}},F=M(()=>Math.ceil(o.value.length/y.value)),G=M(()=>(p.value-1)*y.value+1),H=M(()=>Math.min(p.value*y.value,o.value.length)),T=M(()=>{const a=(p.value-1)*y.value,e=a+y.value;return o.value.slice(a,e)}),q=a=>x(this,null,function*(){try{const e=yield fetch(`/api/method/client_management.client_management.doctype.clientformdata.clientformdata.get_client_details?name=${encodeURIComponent(a.name)}`);if(!e.ok)throw new Error("Failed to fetch client details");const l=yield e.json();if(!l.message)throw new Error("Client data not found");const r=l.message;console.log("Client Data:",r);let s="None";r.contact_persons&&r.contact_persons.length>0&&(s=r.contact_persons.map(f=>`
        - Name: ${f.full_name||"Not specified"}
        Email: ${f.email||"Not specified"}
        Mobile: ${f.mobile_no||"Not specified"}
        Gender: ${f.gender||"Not specified"}
        Bio: ${f.bio||"Not specified"}
      `).join(`

`));let m="None";r.selected_users&&r.selected_users.length>0&&(m=r.selected_users.map(f=>`
        - Name: ${f.full_name||"Not specified"}
        Email: ${f.email||"Not specified"}
        Mobile: ${f.mobile_no||"Not specified"}
        Gender: ${f.gender||"Not specified"}
        Bio: ${f.bio||"Not specified"}
      `).join(`

`));const n=`
      CLIENT DETAILS
      ==============
      Client Name: ${r.client_name||"Not available"}
     
      CONTACT PERSONS:
      ${s}
     
      SELECTED USERS:
      ${m}
     
      Created At: ${r.created_at?new Date(r.created_at).toLocaleString():"Unknown date"}
      Created By: ${r.created_by||"Unknown"}
    `;alert(n)}catch(e){console.error("Error viewing client:",e),alert("Error loading client details: "+e.message)}}),J=a=>{N.push({name:"EditClientFile",params:{name:a.name}})},X=a=>{confirm(`Are you sure you want to permanently delete ${a.client_name}? This action cannot be undone.`)&&Y(a)},Y=a=>x(this,null,function*(){var e;try{const l=yield fetch(`/api/resource/ClientFormData/${a.name}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":((e=window.frappe)==null?void 0:e.csrf_token)||""}}),r=yield l.json();if(l.ok){o.value=o.value.filter(n=>n.name!==a.name),h.value=h.value.filter(n=>n!==a.name);const s=o.value.length,m=Math.ceil(s/y.value);p.value>m&&(p.value=m||1),typeof frappe!="undefined"&&frappe.show_alert?frappe.show_alert({message:typeof __=="function"?__("Data deleted successfully"):"Data deleted successfully",indicator:"green"},5):alert("Data deleted successfully")}else throw new Error(r.message||"Failed to delete client")}catch(l){console.error("Delete failed:",l),typeof frappe!="undefined"&&frappe.show_alert?frappe.show_alert({message:(typeof __=="function"?__("Error: "):"Error: ")+l.message,indicator:"red"},5):alert("Error: "+l.message)}});re(h,a=>{j.value=a.length===T.value.length&&T.value.length>0},{deep:!0});const U=(a,e)=>{$(a).select2({width:"100%",placeholder:"Select options",allowClear:!0}).on("change",l=>{g[e]=$(l.target).val()})},Z=()=>x(this,null,function*(){try{const e=yield(yield fetch("/api/method/client_management.client_management.doctype.clientformdata.clientformdata.get_users")).json();d.value=e.message||[],yield fe(),U(S.value,"contact_person"),U(E.value,"selected_users")}catch(a){console.error("Error fetching users:",a),w.value="Failed to load users",k.value="error"}}),A=()=>x(this,null,function*(){console.log("fetch clients");try{const e=yield(yield fetch("/api/method/client_management.client_management.doctype.clientformdata.clientformdata.get_all_clients")).json();o.value=(e.message||[]).map(l=>z(L({},l),{created_at:P(l.creation||l.created_at),emails:l.contact_person?l.contact_person.map(r=>`${r}@example.com`):[]})),p.value=1,h.value=[]}catch(a){console.error("Error fetching clients:",a),w.value="Failed to load clients",k.value="error"}}),K=()=>x(this,null,function*(){var r,s;const a=S.value?Array.from(S.value.selectedOptions).map(m=>{const n=d.value.find(f=>f.name===m.value);return{user:n==null?void 0:n.name,full_name:(n==null?void 0:n.full_name)||(n==null?void 0:n.name),email:(n==null?void 0:n.email)||`${n==null?void 0:n.name}@example.com`}}):[],e=E.value?Array.from(E.value.selectedOptions).map(m=>m.value):[],l={client_name:g.client_name,contact_person:a,selected_users:e};try{const n=yield(yield fetch("/api/method/client_management.client_management.doctype.clientformdata.clientformdata.save_client_form",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":((r=window.frappe)==null?void 0:r.csrf_token)||""},body:JSON.stringify({data:JSON.stringify(l)})})).json();k.value=n.status,w.value=n.message,k.value==="success"&&((s=window.frappe)!=null&&s.show_alert&&window.frappe.show_alert({message:n.message,indicator:"green"},3),yield A(),g.client_name="",$(S.value).val(null).trigger("change"),$(E.value).val(null).trigger("change"))}catch(m){k.value="error",w.value="An error occurred while submitting the form: "+m.message}}),Q=()=>{p.value<F.value&&(p.value++,h.value=[])},W=()=>{p.value>1&&(p.value--,h.value=[])};return ie(()=>x(this,null,function*(){yield Z(),yield A()})),(a,e)=>{var l,r;return c(),u(C,null,[t("div",be,[t("div",we,[t("div",_e,[t("div",ye,[e[6]||(e[6]=t("h2",{class:"text-xl font-semibold text-center mb-6"},"Create Client",-1)),t("form",{onSubmit:de(K,["prevent"]),class:"space-y-4 sub"},[t("div",null,[e[2]||(e[2]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Client Name*",-1)),ce(I(ve),{modelValue:g.client_name,"onUpdate:modelValue":e[0]||(e[0]=s=>g.client_name=s),required:""},null,8,["modelValue"])]),t("div",null,[e[3]||(e[3]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Select Contact Person*",-1)),t("div",he,[t("select",{ref_key:"contactPersonRef",ref:S,multiple:"",class:"w-full rounded-l-md border border-gray-300 text-sm"},[(c(!0),u(C,null,D(d.value,s=>(c(),u("option",{key:s.name,value:s.name},i(s.full_name||s.name),9,xe))),128))],512)])]),t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Selected Users*",-1)),t("select",{ref_key:"selectedUsersRef",ref:E,multiple:"",class:"w-full rounded-md border border-gray-300 text-sm"},[(c(!0),u(C,null,D(d.value,s=>(c(),u("option",{key:s.name,value:s.name},i(s.full_name||s.name),9,ke))),128))],512)]),e[5]||(e[5]=t("div",{class:"pt-4"},[t("button",{type:"submit",class:"bg-black text-white px-2 py-2 text-sm rounded"}," Submit ")],-1)),w.value?(c(),me(I(ge),{key:0,variant:k.value==="success"?"green":"red",class:"mt-4"},{default:ue(()=>[v(i(w.value),1)]),_:1},8,["variant"])):B("",!0)],32)])])]),t("div",Ce,[t("div",Ne,[t("div",$e,[t("div",Se,[t("table",Ee,[e[11]||(e[11]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"py-3 px-4 border-b text-left"},"Client Name"),t("th",{class:"py-3 px-4 border-b text-left"},"Created At"),t("th",{class:"py-3 px-4 border-b text-left"},"Created By"),t("th",{class:"py-3 px-4 border-b text-left w-32"},"Actions")])],-1)),t("tbody",null,[(c(!0),u(C,null,D(T.value,s=>(c(),u("tr",{key:s.name,class:"hover:bg-gray-50"},[t("td",De,i(s.client_name),1),t("td",Me,i(s.created_at),1),t("td",je,i(s.created_by),1),t("td",Fe,[t("div",Te,[t("button",{onClick:m=>q(s),class:"text-dark-500 hover:text-dark-700 p-1 rounded hover:bg-dark-50",title:"View"},e[7]||(e[7]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)]),8,Be),t("button",{onClick:m=>J(s),class:"text-dark-500 hover:text-dark-700 p-1 rounded hover:bg-dark-50",title:"Edit"},e[8]||(e[8]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,Pe),t("button",{onClick:m=>X(s),class:"text-dark-500 hover:text-dark-700 p-1 rounded hover:bg-dark-50",title:"Delete"},e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Ue)])])]))),128)),o.value.length===0?(c(),u("tr",Ae,e[10]||(e[10]=[t("td",{colspan:"5",class:"py-4 px-4 text-center text-gray-500"},"No clients found",-1)]))):B("",!0)])]),t("div",Re,[t("div",Ve," Showing "+i(G.value)+" to "+i(H.value)+" of "+i(o.value.length)+" entries ",1),t("div",Le,[t("button",{onClick:W,disabled:p.value===1,class:O(["px-3 py-1 border rounded-md text-sm",{"opacity-50 cursor-not-allowed":p.value===1}])}," Previous ",10,ze),t("button",{onClick:Q,disabled:p.value===F.value,class:O(["px-3 py-1 border rounded-md text-sm",{"opacity-50 cursor-not-allowed":p.value===F.value}])}," Next ",10,Ie)])])])])])])]),a.viewModalVisible?(c(),u("div",Oe,[t("div",Ge,[e[28]||(e[28]=t("h2",{class:"text-xl font-bold mb-4"},"Client Details",-1)),t("div",He,[e[15]||(e[15]=t("h3",{class:"font-semibold text-lg mb-2"},"Client Information",-1)),t("p",null,[e[12]||(e[12]=t("span",{class:"font-medium"},"Name:",-1)),v(" "+i(a.viewedClient.client_name),1)]),t("p",null,[e[13]||(e[13]=t("span",{class:"font-medium"},"Created At:",-1)),v(" "+i(P(a.viewedClient.created_at)),1)]),t("p",null,[e[14]||(e[14]=t("span",{class:"font-medium"},"Created By:",-1)),v(" "+i(a.viewedClient.created_by),1)])]),t("div",qe,[e[21]||(e[21]=t("h3",{class:"font-semibold text-lg mb-2"},"Contact Persons",-1)),(l=a.viewedClient.contact_persons)!=null&&l.length?(c(),u("div",Je,[(c(!0),u(C,null,D(a.viewedClient.contact_persons,s=>(c(),u("div",{key:s.name,class:"border p-3 rounded"},[t("p",null,[e[16]||(e[16]=t("span",{class:"font-medium"},"Name:",-1)),v(" "+i(s.full_name),1)]),t("p",null,[e[17]||(e[17]=t("span",{class:"font-medium"},"Email:",-1)),v(" "+i(s.email),1)]),t("p",null,[e[18]||(e[18]=t("span",{class:"font-medium"},"Mobile:",-1)),v(" "+i(s.mobile_no||"Not specified"),1)]),t("p",null,[e[19]||(e[19]=t("span",{class:"font-medium"},"Gender:",-1)),v(" "+i(s.gender||"Not specified"),1)]),t("p",null,[e[20]||(e[20]=t("span",{class:"font-medium"},"Bio:",-1)),v(" "+i(s.bio||"Not specified"),1)])]))),128))])):(c(),u("p",Xe,"No contact persons"))]),t("div",Ye,[e[27]||(e[27]=t("h3",{class:"font-semibold text-lg mb-2"},"Selected Users",-1)),(r=a.viewedClient.selected_users)!=null&&r.length?(c(),u("div",Ze,[(c(!0),u(C,null,D(a.viewedClient.selected_users,s=>(c(),u("div",{key:s.name,class:"border p-3 rounded"},[t("p",null,[e[22]||(e[22]=t("span",{class:"font-medium"},"Name:",-1)),v(" "+i(s.full_name),1)]),t("p",null,[e[23]||(e[23]=t("span",{class:"font-medium"},"Email:",-1)),v(" "+i(s.email),1)]),t("p",null,[e[24]||(e[24]=t("span",{class:"font-medium"},"Mobile:",-1)),v(" "+i(s.mobile_no||"Not specified"),1)]),t("p",null,[e[25]||(e[25]=t("span",{class:"font-medium"},"Gender:",-1)),v(" "+i(s.gender||"Not specified"),1)]),t("p",null,[e[26]||(e[26]=t("span",{class:"font-medium"},"Bio:",-1)),v(" "+i(s.bio||"Not specified"),1)])]))),128))])):(c(),u("p",Ke,"No selected users"))]),t("button",{onClick:e[1]||(e[1]=s=>a.viewModalVisible=!1),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Close ")])])):B("",!0)],64)}}},tt=oe(Qe,[["__scopeId","data-v-b03c4daa"]]);export{tt as default};
//# sourceMappingURL=ClientForm-C50eSLvd.js.map
