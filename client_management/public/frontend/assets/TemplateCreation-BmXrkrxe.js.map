{"version":3,"file":"TemplateCreation-BmXrkrxe.js","sources":["../../../../frontend/src/pages/TemplateCreation.vue"],"sourcesContent":["<template>\r\n  <div class=\"max-w-3xl mx-auto p-6\">\r\n    <!-- Success/Error Messages -->\r\n    <div v-if=\"showSuccess\" class=\"mb-4 p-4 bg-green-100 text-green-700 rounded-md\">\r\n      Template created successfully!\r\n    </div>\r\n    <div v-if=\"showError\" class=\"mb-4 p-4 bg-red-100 text-red-700 rounded-md\">\r\n      {{ errorMessage }}\r\n    </div>\r\n\r\n    <div class=\"card\">\r\n      <h2 class=\"card-header\">Create New Template</h2>\r\n     <form @submit.prevent=\"submitForm\" class=\"card-body\">\r\n  <Input\r\n    label=\"Template Name\"\r\n    v-model=\"formData.template_name\"\r\n    type=\"text\"\r\n    required\r\n    class=\"mb-4\"\r\n  />\r\n\r\n  <div v-for=\"(task, index) in formData.tasks\" :key=\"index\" class=\"card mb-4 relative\">\r\n    <div v-if=\"index > 0\" class=\"absolute top-2 right-2\">\r\n      <Button @click=\"removeTask(index)\" variant=\"ghost\" size=\"sm\">\r\n        Remove\r\n      </Button>\r\n    </div>\r\n    \r\n    <h3 class=\"card-header\">Task {{ index + 1 }}</h3>\r\n    <div class=\"card-body\">\r\n      <!-- Is Child Task Checkbox -->\r\n      <div v-if=\"index > 0\" class=\"mb-4\">\r\n        <Checkbox\r\n          v-model=\"task.is_child\"\r\n          @change=\"handleChildToggle(task, index)\"\r\n          label=\"Is Child Task\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Parent Task Dropdown (if child task) -->\r\n      <div v-if=\"task.is_child\" class=\"mb-4\">\r\n        <Select\r\n          v-model=\"task.parent_task\"\r\n          :options=\"[\r\n            { label: 'Select Parent Task', value: '' },\r\n            ...availableParentTasks(index).map((parent, parentIndex) => ({\r\n              label: parent.task_name || `Task ${parentIndex + 1}`,\r\n              value: parentIndex\r\n            }))\r\n          ]\"\r\n          label=\"Parent Task\"\r\n          required\r\n        />\r\n      </div>\r\n\r\n      <!-- Task Name -->\r\n      <Input\r\n        label=\"Task Name\"\r\n        v-model=\"task.task_name\"\r\n        type=\"text\"\r\n        required\r\n        class=\"mb-4\"\r\n      />\r\n\r\n      <!-- NEW: 4 Fields in One Row -->\r\n      <div class=\"grid grid-cols-4 gap-4 \">\r\n        <Select class=\"mt-3\"\r\n          v-model=\"task.task_type\"\r\n          :options=\"[\r\n            { label: 'Task Type', value: '' },\r\n            { label: 'Internal', value: 'Internal' },\r\n            { label: 'Client', value: 'Client' }\r\n          ]\"\r\n          required\r\n        />\r\n        <Input\r\n          label=\"Complete Within Days\"\r\n          v-model=\"task.complete_within_days\"\r\n          type=\"number\"\r\n          min=\"1\"\r\n          required\r\n        />\r\n        <Input\r\n          label=\"From Date\"\r\n          v-model=\"task.from_date\"\r\n          type=\"date\"\r\n          :disabled=\"task.is_child\"\r\n          :required=\"!task.is_child\"\r\n        />\r\n        <Input\r\n          label=\"To Date\"\r\n          v-model=\"task.to_date\"\r\n          type=\"date\"\r\n          :disabled=\"task.is_child\"\r\n          :required=\"!task.is_child\"\r\n        />\r\n      </div>\r\n\r\n      <!-- Description -->\r\n      <Textarea\r\n        label=\"Description\"\r\n        v-model=\"task.description\"\r\n        rows=\"3\"\r\n      />\r\n    </div>\r\n  </div>\r\n\r\n  <!-- Add Task Button -->\r\n  <Button\r\n    type=\"button\"\r\n    @click=\"addTask\"\r\n    variant=\"outline\"\r\n    class=\"w-full mb-4\"\r\n  >\r\n    + Add Task\r\n  </Button>\r\n\r\n  <!-- Submit Button -->\r\n  <Button\r\n    type=\"submit\"\r\n    variant=\"solid\"\r\n    theme=\"gray\"\r\n    size=\"sm\"\r\n    :loading=\"loading\"\r\n    class=\"w-full\"\r\n  >\r\n    {{ loading ? 'Saving...' : 'Create Template' }}\r\n  </Button>\r\n</form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, computed } from 'vue'\r\nimport { Input, Textarea, Button, createResource, Select, Checkbox } from 'frappe-ui'\r\n\r\nconst formData = ref({\r\n  template_name: '',\r\n  tasks: [{\r\n    task_name: '',\r\n    task_type: '',\r\n    complete_within_days: 1,\r\n    from_date: '',\r\n    to_date: '',\r\n    description: '',\r\n    is_child: false,\r\n    parent_task: null\r\n  }]\r\n})\r\n\r\nconst loading = ref(false)\r\nconst showSuccess = ref(false)\r\nconst showError = ref(false)\r\nconst errorMessage = ref('')\r\n\r\n\r\nconst addTask = () => {\r\n  formData.value.tasks.push({\r\n    task_name: '',\r\n    task_type: '',\r\n    complete_within_days: 1,\r\n    from_date: '',\r\n    to_date: '',\r\n    description: '',\r\n    is_child: false,\r\n    parent_task: null\r\n  })\r\n}\r\n\r\n\r\nconst removeTask = (index) => {\r\n  formData.value.tasks.splice(index, 1)\r\n}\r\n\r\n\r\nconst handleChildToggle = (task, index) => {\r\n  if (task.is_child) {\r\n    task.from_date = ''\r\n    task.to_date = ''\r\n  }\r\n}\r\n\r\nconst availableParentTasks = (currentIndex) => {\r\n  return formData.value.tasks.slice(0, currentIndex)\r\n}\r\n\r\nconst submitForm = async () => {\r\n  \r\n  showSuccess.value = false\r\n  showError.value = false\r\n  errorMessage.value = ''\r\n  \r\n  loading.value = true\r\n  \r\n  try {\r\n    \r\n    const tasksToSubmit = formData.value.tasks.map((task, index) => {\r\n      const taskData = {\r\n        task_name: task.task_name,\r\n        task_type: task.task_type,\r\n        complete_within_days: task.complete_within_days,\r\n        description: task.description,\r\n        is_child: task.is_child || false,\r\n        parent_index: task.is_child ? parseInt(task.parent_task) : null \r\n      }\r\n\r\n      if (!task.is_child) {\r\n        taskData.from_date = task.from_date\r\n        taskData.to_date = task.to_date\r\n      }\r\n\r\n      return taskData\r\n    })\r\n\r\n    const resource = createResource({\r\n      url: 'client_management.client_management.doctype.template.template.create_template_with_task',\r\n      method: 'POST',\r\n      params: {\r\n        template_name: formData.value.template_name,\r\n        tasks: tasksToSubmit\r\n      }\r\n    })\r\n\r\n    await resource.submit()\r\n    \r\n   \r\n    showSuccess.value = true\r\n    \r\n    \r\n    formData.value = {\r\n      template_name: '',\r\n      tasks: [{\r\n        task_name: '',\r\n        task_type: '',\r\n        complete_within_days: 1,\r\n        from_date: '',\r\n        to_date: '',\r\n        description: '',\r\n        is_child: false,\r\n        parent_task: null\r\n      }]\r\n    }\r\n\r\n    \r\n    setTimeout(() => {\r\n      showSuccess.value = false\r\n    }, 3000)\r\n\r\n  } catch (error) {\r\n    \r\n    showError.value = true\r\n    errorMessage.value = error.message || 'Failed to create template'\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.card {\r\n  @apply bg-white rounded-lg shadow border border-gray-200;\r\n}\r\n.card-header {\r\n  @apply px-6 py-4 border-b border-gray-200 font-semibold text-lg;\r\n}\r\n.card-body {\r\n  @apply p-6;\r\n}\r\n</style>"],"names":["formData","ref","loading","showSuccess","showError","errorMessage","addTask","removeTask","index","handleChildToggle","task","availableParentTasks","currentIndex","submitForm","__async","tasksToSubmit","taskData","createResource","error","_openBlock","_createElementBlock","_hoisted_1","_hoisted_2","_hoisted_3","_toDisplayString","_createElementVNode","_hoisted_4","_cache","_createVNode","_unref","Input","$event","_Fragment","_hoisted_5","Button","_hoisted_6","_hoisted_7","_hoisted_8","Checkbox","_hoisted_9","Select","parent","parentIndex","_hoisted_10","Textarea"],"mappings":"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"}