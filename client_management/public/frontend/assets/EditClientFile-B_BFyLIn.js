var x=(h,f,o)=>new Promise((i,r)=>{var s=l=>{try{c(o.next(l))}catch(u){r(u)}},m=l=>{try{c(o.throw(l))}catch(u){r(u)}},c=l=>l.done?i(l.value):Promise.resolve(l.value).then(s,m);c((o=o.apply(h,f)).next())});import{r as g,aa as R,c as w,U as F,q as P,a as p,b as a,j as T,d as y,u as b,F as C,k,a9 as V,e as j,o as _,ab as N,t as S,l as E}from"./index-CK1KYSDl.js";const O={class:"container mx-auto px-4 py-8"},B={class:"grid grid-cols-1 lg:grid-cols-8 gap-8"},q={class:"lg:col-span-8"},L={class:"bg-white p-6 shadow-md rounded-md"},M={class:"flex"},D=["value"],J=["value"],X={class:"pt-4 flex justify-start space-x-2"},G={__name:"EditClientFile",setup(h){const f=V(),o=j(),i=g(!1),r=g([]),s=R({client_name:"",contact_person:[],selected_users:[]}),m=g(null),c=g(null);w({url:"client_management.client_management.doctype.clientformdata.clientformdata.get_edit_client_details",params:{name:f.params.name},auto:!0,onSuccess(n){var e,t;s.client_name=n.client_name,s.contact_person=((e=n.contact_persons)==null?void 0:e.map(d=>d.name))||[],s.selected_users=((t=n.selected_users)==null?void 0:t.map(d=>d.name))||[],l()},onError(n){console.error("Error fetching client:",n),o.push({name:"ClientList"})}}),w({url:"client_management.client_management.doctype.clientformdata.clientformdata.get_users",auto:!0,onSuccess(n){r.value=n,s.client_name&&l()}});const l=()=>{F(()=>{$(m.value).select2({width:"100%",placeholder:"Select contact persons",allowClear:!0,closeOnSelect:!1}).val(s.contact_person).trigger("change"),$(c.value).select2({width:"100%",placeholder:"Select users",allowClear:!0,closeOnSelect:!1}).val(s.selected_users).trigger("change")})},u=()=>x(this,null,function*(){var n;try{i.value=!0;const e=$(m.value).val()||[],t=$(c.value).val()||[],d=yield fetch("/api/method/client_management.client_management.doctype.clientformdata.clientformdata.update_client",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":((n=window.frappe)==null?void 0:n.csrf_token)||""},body:JSON.stringify({name:f.params.name,data:{client_name:s.client_name,contact_person:e,selected_users:t}})});if(!d.ok)throw new Error("Failed to update client");const v=yield d.json();if(v.message&&v.message==="success")alert("Updated successfully"),setTimeout(()=>{o.push({name:"Client Creation"})},500);else throw new Error(v.message||"Update failed")}catch(e){console.error("Error updating client:",e),window.frappe.show_alert({message:"Error: "+e.message,indicator:"red"},5)}finally{i.value=!1}}),U=()=>{o.push({name:"Client Creation"})};return P(()=>{r.value.length&&s.client_name&&l()}),(n,e)=>(_(),p("div",O,[a("div",B,[a("div",q,[a("div",L,[e[4]||(e[4]=a("h2",{class:"text-xl font-semibold text-center mb-6"},"Edit Client",-1)),a("form",{onSubmit:T(u,["prevent"]),class:"space-y-4"},[a("div",null,[e[1]||(e[1]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Client Name *",-1)),y(b(N),{modelValue:s.client_name,"onUpdate:modelValue":e[0]||(e[0]=t=>s.client_name=t),required:""},null,8,["modelValue"])]),a("div",null,[e[2]||(e[2]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Select Contact Person *",-1)),a("div",M,[a("select",{ref_key:"contactPersonRef",ref:m,multiple:"",class:"w-full rounded-l-md border border-gray-300 text-sm"},[(_(!0),p(C,null,k(r.value,t=>(_(),p("option",{key:t.name,value:t.name},S(t.full_name||t.name),9,D))),128))],512)])]),a("div",null,[e[3]||(e[3]=a("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Select Users *",-1)),a("select",{ref_key:"selectedUsersRef",ref:c,multiple:"",class:"w-full rounded-md border border-gray-300 text-sm"},[(_(!0),p(C,null,k(r.value,t=>(_(),p("option",{key:t.name,value:t.name},S(t.full_name||t.name),9,J))),128))],512)]),a("div",X,[y(b(E),{type:"button",label:"Cancel",class:"w-auto px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 text-sm",onClick:U,disabled:i.value},null,8,["disabled"]),y(b(E),{type:"submit",label:"Update",class:"w-auto px-4 py-2 text-sm",loading:i.value},null,8,["loading"])])],32)])])])]))}};export{G as default};
//# sourceMappingURL=EditClientFile-B_BFyLIn.js.map
