{"version":3,"file":"EditClientFile-B_BFyLIn.js","sources":["../../../../frontend/src/pages/EditClientFile.vue"],"sourcesContent":["<template>\r\n  <div class=\"container mx-auto px-4 py-8\">\r\n    <div class=\"grid grid-cols-1 lg:grid-cols-8 gap-8\">\r\n      <div class=\"lg:col-span-8\">\r\n        <div class=\"bg-white p-6 shadow-md rounded-md\">\r\n          <h2 class=\"text-xl font-semibold text-center mb-6\">Edit Client</h2>\r\n         \r\n          <form @submit.prevent=\"submitForm\" class=\"space-y-4\">\r\n            <!-- Client Name -->\r\n            <div>\r\n              <label class=\"block text-sm font-medium text-gray-700 mb-1\">Client Name *</label>\r\n              <TextInput v-model=\"form.client_name\" required />\r\n            </div>\r\n \r\n            <!-- Contact Person -->\r\n            <div>\r\n              <label class=\"block text-sm font-medium text-gray-700 mb-1\">Select Contact Person *</label>\r\n              <div class=\"flex\">\r\n                <select\r\n                  ref=\"contactPersonRef\"\r\n                  multiple\r\n                  class=\"w-full rounded-l-md border border-gray-300 text-sm\"\r\n                >\r\n                  <option v-for=\"user in users\" :key=\"user.name\" :value=\"user.name\">\r\n                    {{ user.full_name || user.name }}\r\n                  </option>\r\n                </select>\r\n                          </div>\r\n            </div>\r\n \r\n            <!-- Selected Users -->\r\n            <div>\r\n              <label class=\"block text-sm font-medium text-gray-700 mb-1\">Select Users *</label>\r\n              <select\r\n                ref=\"selectedUsersRef\"\r\n                multiple\r\n                class=\"w-full rounded-md border border-gray-300 text-sm\"\r\n              >\r\n                <option v-for=\"user in users\" :key=\"user.name\" :value=\"user.name\">\r\n                  {{ user.full_name || user.name }}\r\n                </option>\r\n              </select>\r\n            </div>\r\n \r\n            <!-- Submit Button -->\r\n <div class=\"pt-4 flex justify-start space-x-2\">\r\n  <Button\r\n    type=\"button\"\r\n    label=\"Cancel\"\r\n    class=\"w-auto px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-800 text-sm\"\r\n    @click=\"handleCancel\"\r\n    :disabled=\"loading\"\r\n  />\r\n  <Button\r\n    type=\"submit\"\r\n    label=\"Update\"\r\n    class=\"w-auto px-4 py-2 text-sm\"\r\n    :loading=\"loading\"\r\n  />\r\n</div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n \r\n<script setup>\r\nimport { ref, reactive, onMounted, nextTick } from 'vue'\r\nimport { TextInput, Button, createResource } from 'frappe-ui'\r\nimport { useRoute, useRouter } from 'vue-router'\r\n \r\n \r\nconst route = useRoute()\r\nconst router = useRouter()\r\nconst loading = ref(false)\r\n \r\n// State\r\nconst users = ref([])\r\nconst form = reactive({\r\n  client_name: '',\r\n  contact_person: [],\r\n  selected_users: []\r\n})\r\n \r\n// Refs for select elements\r\nconst contactPersonRef = ref(null)\r\nconst selectedUsersRef = ref(null)\r\n \r\n// Fetch client data\r\nconst fetchClient = createResource({\r\n  url: 'client_management.client_management.doctype.clientformdata.clientformdata.get_edit_client_details',\r\n  params: { name: route.params.name },\r\n  auto: true,\r\n  onSuccess(data) {\r\n    form.client_name = data.client_name\r\n    form.contact_person = data.contact_persons?.map(p => p.name) || []\r\n    form.selected_users = data.selected_users?.map(u => u.name) || []\r\n    initSelect2()\r\n  },\r\n  onError(error) {\r\n    console.error('Error fetching client:', error)\r\n    router.push({ name: 'ClientList' })\r\n  }\r\n})\r\n \r\n \r\n// Fetch all users\r\nconst fetchUsers = createResource({\r\n  url: 'client_management.client_management.doctype.clientformdata.clientformdata.get_users',\r\n  auto: true,\r\n  onSuccess(data) {\r\n    users.value = data\r\n    // If client data is already loaded, initialize select2\r\n    if (form.client_name) initSelect2()\r\n  }\r\n})\r\n \r\n// Initialize Select2 with current selections\r\nconst initSelect2 = () => {\r\n  nextTick(() => {\r\n    // Initialize Contact Person Select2\r\n    $(contactPersonRef.value).select2({\r\n      width: '100%',\r\n      placeholder: 'Select contact persons',\r\n      allowClear: true,\r\n      closeOnSelect: false\r\n    }).val(form.contact_person).trigger('change')\r\n \r\n    // Initialize Users Select2\r\n    $(selectedUsersRef.value).select2({\r\n      width: '100%',\r\n      placeholder: 'Select users',\r\n      allowClear: true,\r\n      closeOnSelect: false\r\n    }).val(form.selected_users).trigger('change')\r\n  })\r\n}\r\n \r\n// Handle form submission\r\nconst submitForm = async () => {\r\n  try {\r\n    loading.value = true\r\n   \r\n    // Get current selections from Select2\r\n    const contactPersons = $(contactPersonRef.value).val() || []\r\n    const selectedUsers = $(selectedUsersRef.value).val() || []\r\n \r\n    const response = await fetch('/api/method/client_management.client_management.doctype.clientformdata.clientformdata.update_client', {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'X-Frappe-CSRF-Token': window.frappe?.csrf_token || ''\r\n      },\r\n      body: JSON.stringify({\r\n        name: route.params.name,\r\n        data: {\r\n          client_name: form.client_name,\r\n          contact_person: contactPersons,\r\n          selected_users: selectedUsers\r\n        }\r\n      })\r\n    })\r\n \r\n    if (!response.ok) throw new Error('Failed to update client')\r\n \r\n    const result = await response.json()\r\n   \r\n    if (result.message && result.message === 'success') {\r\n      // Show success message\r\n      alert(\"Updated successfully\");\r\n     \r\n     \r\n     \r\n      // Redirect to ClientForm after a slight delay to show the message\r\n      setTimeout(() => {\r\n        router.push({ name: 'Client Creation' })\r\n      }, 500)\r\n    } else {\r\n      throw new Error(result.message || 'Update failed')\r\n    }\r\n  } catch (error) {\r\n    console.error('Error updating client:', error)\r\n    window.frappe.show_alert({\r\n      message: 'Error: ' + error.message,\r\n      indicator: 'red'\r\n    }, 5)\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n \r\n \r\nconst handleCancel = () => {\r\n  router.push({ name: 'Client Creation' }) // Make sure this matches your route name\r\n}\r\n \r\nonMounted(() => {\r\n  // Initialize when both client and users data are loaded\r\n  if (users.value.length && form.client_name) {\r\n    initSelect2()\r\n  }\r\n})\r\n</script>\r\n \r\n<style>\r\n/* Your existing Select2 styles */\r\n.select2-container--default .select2-selection--multiple {\r\n  border: 1px solid #d1d5db !important;\r\n  border-radius: 0.375rem !important;\r\n  min-height: 38px !important;\r\n}\r\n \r\n.select2-container--default .select2-selection--multiple .select2-selection__choice {\r\n  background-color: #e5e7eb !important;\r\n  border: 1px solid #d1d5db !important;\r\n  border-radius: 0.25rem !important;\r\n  padding: 0 5px !important;\r\n}\r\n \r\n.select2-container--default .select2-selection--multiple .select2-selection__choice__remove {\r\n  color: #6b7280 !important;\r\n  margin-right: 3px !important;\r\n}\r\n \r\n.select2-container--default .select2-search--inline .select2-search__field {\r\n  margin-top: 0 !important;\r\n  padding: 5px !important;\r\n}\r\n</style>\r\n "],"names":["route","useRoute","router","useRouter","loading","ref","users","form","reactive","contactPersonRef","selectedUsersRef","createResource","data","_a","p","_b","u","initSelect2","error","nextTick","submitForm","__async","contactPersons","selectedUsers","response","result","handleCancel","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_cache","_createVNode","_unref","TextInput","$event","_hoisted_5","_Fragment","_renderList","user","_toDisplayString","_hoisted_6","_hoisted_7","_hoisted_8","Button"],"mappings":"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"}