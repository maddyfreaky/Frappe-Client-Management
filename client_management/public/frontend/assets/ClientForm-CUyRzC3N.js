var re=Object.defineProperty,ie=Object.defineProperties;var de=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable;var O=(b,c,d)=>c in b?re(b,c,{enumerable:!0,configurable:!0,writable:!0,value:d}):b[c]=d,G=(b,c)=>{for(var d in c||(c={}))ce.call(c,d)&&O(b,d,c[d]);if(z)for(var d of z(c))ue.call(c,d)&&O(b,d,c[d]);return b},H=(b,c)=>ie(b,de(c));var C=(b,c,d)=>new Promise((_,u)=>{var x=y=>{try{k(d.next(y))}catch(f){u(f)}},m=y=>{try{k(d.throw(y))}catch(f){u(f)}},k=y=>y.done?_(y.value):Promise.resolve(y.value).then(x,m);k((d=d.apply(b,c)).next())});import{j as me,r as w,aa as pe,A as V,a6 as ve,v as fe,a as i,b as t,i as ge,d as A,u as U,F as N,l as j,k as D,Z as be,w as _e,a7 as J,ab as X,t as a,a2 as q,g as v,e as we,U as ye,o as r,ac as P,ad as he}from"./index-BQMqF1jf.js";const xe={class:"container mx-auto px-4 py-8"},ke={class:"grid grid-cols-1 lg:grid-cols-8 gap-8 mb-8"},Ce={class:"lg:col-span-8"},Ne={class:"bg-white p-6 shadow-md rounded-md"},$e={class:"flex"},Se=["value"],Ee={key:0,class:"space-y-3"},je=["value"],De={class:"grid grid-cols-1 lg:grid-cols-8 gap-8"},Me={class:"lg:col-span-8"},Ve={class:"bg-white p-6 shadow-md rounded-md"},Ue={class:"overflow-x-auto"},Be={class:"min-w-full bg-white border border-gray-200 rounded-lg"},Fe={class:"bg-gray-100"},Te={class:"py-3 px-4 border-b text-left w-10"},Ae={class:"py-3 px-4 border-b"},Pe=["value"],Re={class:"py-3 px-4 border-b"},Ie={class:"py-3 px-4 border-b"},Le={class:"py-3 px-4 border-b"},ze={class:"py-3 px-4 border-b"},Oe={class:"flex space-x-2"},Ge=["onClick"],He=["onClick"],Je=["onClick"],Xe={key:0},qe={key:0,class:"mt-4 p-3 bg-blue-50 rounded-lg"},Ye={class:"flex items-center justify-between"},Ze={class:"text-sm text-blue-700"},Ke={class:"flex items-center justify-between mt-4"},Qe={class:"text-sm text-gray-500"},We={class:"flex space-x-2"},et=["disabled"],tt=["disabled"],st={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},lt={class:"bg-white rounded-lg p-6 max-w-2xl w-full max-h-[80vh] overflow-auto"},ot={class:"mb-6"},at={class:"mb-6"},nt={key:0,class:"space-y-4"},rt={key:1},it={class:"mb-6"},dt={key:0,class:"space-y-4"},ct={key:1},ut={__name:"ClientForm",setup(b){const c=w([]),d=w([]),_=w([]),u=w(1),x=w(10),m=w([]),k=w(!1),y=we(),f=pe({client_name:"",contact_person:[],selected_users:[]}),S=w(""),E=w(""),B=w(null),F=w(null),R=l=>{if(!l)return"Unknown date";try{const e=new Date(l);if(isNaN(e.getTime()))return l;const o=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear(),p=String(e.getHours()).padStart(2,"0"),h=String(e.getMinutes()).padStart(2,"0"),g=String(e.getSeconds()).padStart(2,"0");return`${o}-${n}-${s} ${p}:${h}:${g}`}catch(e){return console.error("Error formatting date:",e),l}},T=V(()=>Math.ceil(_.value.length/x.value)),Y=V(()=>(u.value-1)*x.value+1),Z=V(()=>Math.min(u.value*x.value,_.value.length)),M=V(()=>{const l=(u.value-1)*x.value,e=l+x.value;return _.value.slice(l,e)}),K=l=>C(this,null,function*(){try{const e=yield fetch(`/api/method/client_management.client_management.doctype.clientformdata.clientformdata.get_client_details?name=${encodeURIComponent(l.name)}`);if(!e.ok)throw new Error("Failed to fetch client details");const o=yield e.json();if(!o.message)throw new Error("Client data not found");const n=o.message;let s="None";n.contact_persons&&n.contact_persons.length>0&&(s=n.contact_persons.map(g=>`
        - Name: ${g.full_name}
        Email: ${g.email}
        Mobile: ${g.mobile_no||"Not specified"}
        Gender: ${g.gender||"Not specified"}
        Bio: ${g.bio}
      `).join(`

`));let p="None";n.selected_users&&n.selected_users.length>0&&(p=n.selected_users.map(g=>`
        - Name: ${g.full_name}
        Email: ${g.email}
        Mobile: ${g.mobile_no||"Not specified"}
        Gender: ${g.gender||"Not specified"}
        Bio: ${g.bio}
      `).join(`

`));const h=`
      CLIENT DETAILS
      ==============
      Client Name: ${n.client_name||"Not available"}
     
      CONTACT PERSONS:
      ${s}
     
      SELECTED USERS:
      ${p}
     
      Created At: ${n.created_at?new Date(n.created_at).toLocaleString():"Unknown date"}
      Created By: ${n.created_by||"Unknown"}
    `;alert(h)}catch(e){console.error("Error viewing client:",e),alert("Error loading client details: "+e.message)}}),Q=l=>{y.push({name:"EditClientFile",params:{name:l.name}})},W=l=>{confirm(`Are you sure you want to permanently delete ${l.client_name}? This action cannot be undone.`)&&ee(l)},ee=l=>C(this,null,function*(){var e;try{const o=yield fetch(`/api/resource/ClientFormData/${l.name}`,{method:"DELETE",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":((e=window.frappe)==null?void 0:e.csrf_token)||""}}),n=yield o.json();if(o.ok){_.value=_.value.filter(h=>h.name!==l.name),m.value=m.value.filter(h=>h!==l.name);const s=_.value.length,p=Math.ceil(s/x.value);u.value>p&&(u.value=p||1),typeof frappe!="undefined"&&frappe.show_alert?frappe.show_alert({message:typeof __=="function"?__("Data deleted successfully"):"Data deleted successfully",indicator:"green"},5):alert("Data deleted successfully")}else throw new Error(n.message||"Failed to delete client")}catch(o){console.error("Delete failed:",o),typeof frappe!="undefined"&&frappe.show_alert?frappe.show_alert({message:(typeof __=="function"?__("Error: "):"Error: ")+o.message,indicator:"red"},5):alert("Error: "+o.message)}}),te=()=>{k.value?m.value=M.value.map(l=>l.name):m.value=[]},se=()=>{alert(`Performing action on selected clients: ${m.value.join(", ")}`)};ve(m,l=>{k.value=l.length===M.value.length&&M.value.length>0},{deep:!0});const I=(l,e)=>{$(l).select2({width:"100%",placeholder:"Select options",allowClear:!0}).on("change",o=>{f[e]=$(o.target).val()})},le=()=>C(this,null,function*(){try{const e=yield(yield fetch("/api/method/client_management.api.user.get_users")).json();c.value=e.message||[],yield ye(),I(B.value,"contact_person"),I(F.value,"selected_users")}catch(l){console.error("Error fetching users:",l),S.value="Failed to load users",E.value="error"}}),L=()=>C(this,null,function*(){try{const e=yield(yield fetch("/api/method/client_management.client_management.doctype.clientformdata.clientformdata.get_all_clients")).json();_.value=(e.message||[]).map(o=>H(G({},o),{created_at:R(o.creation||o.created_at),emails:o.contact_person?o.contact_person.map(n=>`${n}@example.com`):[]})),u.value=1,m.value=[]}catch(l){console.error("Error fetching clients:",l),S.value="Failed to load clients",E.value="error"}}),oe=()=>C(this,null,function*(){var e,o;const l={client_name:f.client_name,contact_person:f.contact_person,selected_users:f.selected_users};try{const s=yield(yield fetch("/api/method/client_management.client_management.doctype.clientformdata.clientformdata.save_client_form",{method:"POST",headers:{"Content-Type":"application/json","X-Frappe-CSRF-Token":((e=window.frappe)==null?void 0:e.csrf_token)||""},body:JSON.stringify({data:JSON.stringify(l)})})).json();E.value=s.status,S.value=s.message,E.value==="success"&&((o=window.frappe)!=null&&o.show_alert&&window.frappe.show_alert({message:s.message,indicator:"green"},3),f.client_name="",f.contact_person=[],f.selected_users=[],d.value=[],$(B.value).val(null).trigger("change"),$(F.value).val(null).trigger("change"),yield L())}catch(n){E.value="error",S.value="An error occurred while submitting the form: "+n.message}}),ae=()=>{u.value<T.value&&(u.value++,m.value=[])},ne=()=>{u.value>1&&(u.value--,m.value=[])};return fe(()=>C(this,null,function*(){yield le(),yield L()})),(l,e)=>{var o,n;return r(),i(N,null,[t("div",xe,[t("div",ke,[t("div",Ce,[t("div",Ne,[e[8]||(e[8]=t("h2",{class:"text-xl font-semibold text-center mb-6"},"Create Client",-1)),t("form",{onSubmit:ge(oe,["prevent"]),class:"space-y-4 sub"},[t("div",null,[e[4]||(e[4]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Client Name*",-1)),A(U(P),{modelValue:f.client_name,"onUpdate:modelValue":e[0]||(e[0]=s=>f.client_name=s),required:""},null,8,["modelValue"])]),t("div",null,[e[5]||(e[5]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Select Contact Person*",-1)),t("div",$e,[t("select",{ref_key:"contactPersonRef",ref:B,multiple:"",class:"w-full rounded-l-md border border-gray-300 text-sm"},[(r(!0),i(N,null,j(c.value,s=>(r(),i("option",{key:s.name,value:s.name},a(s.full_name||s.name),9,Se))),128))],512)])]),d.value.length?(r(),i("div",Ee,[(r(!0),i(N,null,j(d.value,(s,p)=>(r(),i("div",{key:p,class:"grid grid-cols-1 md:grid-cols-3 gap-4 bg-gray-100 p-3 rounded border border-gray-200"},[A(U(P),{modelValue:s.full_name,label:"Name",readonly:""},null,8,["modelValue"]),A(U(P),{modelValue:s.email,"onUpdate:modelValue":h=>s.email=h,label:"Email"},null,8,["modelValue","onUpdate:modelValue"])]))),128))])):D("",!0),t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Selected Users*",-1)),t("select",{ref_key:"selectedUsersRef",ref:F,multiple:"",class:"w-full rounded-md border border-gray-300 text-sm"},[(r(!0),i(N,null,j(c.value,s=>(r(),i("option",{key:s.name,value:s.name},a(s.full_name||s.name),9,je))),128))],512)]),e[7]||(e[7]=t("div",{class:"pt-4"},[t("button",{type:"submit",class:"bg-black text-white px-2 py-2 text-sm rounded"}," Submit ")],-1)),S.value?(r(),be(U(he),{key:1,variant:E.value==="success"?"green":"red",class:"mt-4"},{default:_e(()=>[v(a(S.value),1)]),_:1},8,["variant"])):D("",!0)],32)])])]),t("div",De,[t("div",Me,[t("div",Ve,[t("div",Ue,[t("table",Be,[t("thead",Fe,[t("tr",null,[t("th",Te,[J(t("input",{type:"checkbox","onUpdate:modelValue":e[1]||(e[1]=s=>k.value=s),onChange:te,class:"h-4 w-4 text-blue-600 rounded focus:ring-blue-500 border-gray-300"},null,544),[[X,k.value]])]),e[9]||(e[9]=t("th",{class:"py-3 px-4 border-b text-left"},"Client Name",-1)),e[10]||(e[10]=t("th",{class:"py-3 px-4 border-b text-left"},"Created At",-1)),e[11]||(e[11]=t("th",{class:"py-3 px-4 border-b text-left"},"Created By",-1)),e[12]||(e[12]=t("th",{class:"py-3 px-4 border-b text-left w-32"},"Actions",-1))])]),t("tbody",null,[(r(!0),i(N,null,j(M.value,s=>(r(),i("tr",{key:s.name,class:"hover:bg-gray-50"},[t("td",Ae,[J(t("input",{type:"checkbox","onUpdate:modelValue":e[2]||(e[2]=p=>m.value=p),value:s.name,class:"h-4 w-4 text-blue-600 rounded focus:ring-blue-500 border-gray-300"},null,8,Pe),[[X,m.value]])]),t("td",Re,a(s.client_name),1),t("td",Ie,a(s.created_at),1),t("td",Le,a(s.created_by),1),t("td",ze,[t("div",Oe,[t("button",{onClick:p=>K(s),class:"text-dark-500 hover:text-dark-700 p-1 rounded hover:bg-dark-50",title:"View"},e[13]||(e[13]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1)]),8,Ge),t("button",{onClick:p=>Q(s),class:"text-dark-500 hover:text-dark-700 p-1 rounded hover:bg-dark-50",title:"Edit"},e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)]),8,He),t("button",{onClick:p=>W(s),class:"text-dark-500 hover:text-dark-700 p-1 rounded hover:bg-dark-50",title:"Delete"},e[15]||(e[15]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Je)])])]))),128)),_.value.length===0?(r(),i("tr",Xe,e[16]||(e[16]=[t("td",{colspan:"5",class:"py-4 px-4 text-center text-gray-500"},"No clients found",-1)]))):D("",!0)])]),m.value.length>0?(r(),i("div",qe,[t("div",Ye,[t("span",Ze,a(m.value.length)+" item(s) selected ",1),t("button",{onClick:se,class:"px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700"}," Bulk Action ")])])):D("",!0),t("div",Ke,[t("div",Qe," Showing "+a(Y.value)+" to "+a(Z.value)+" of "+a(_.value.length)+" entries ",1),t("div",We,[t("button",{onClick:ne,disabled:u.value===1,class:q(["px-3 py-1 border rounded-md text-sm",{"opacity-50 cursor-not-allowed":u.value===1}])}," Previous ",10,et),t("button",{onClick:ae,disabled:u.value===T.value,class:q(["px-3 py-1 border rounded-md text-sm",{"opacity-50 cursor-not-allowed":u.value===T.value}])}," Next ",10,tt)])])])])])])]),l.viewModalVisible?(r(),i("div",st,[t("div",lt,[e[33]||(e[33]=t("h2",{class:"text-xl font-bold mb-4"},"Client Details",-1)),t("div",ot,[e[20]||(e[20]=t("h3",{class:"font-semibold text-lg mb-2"},"Client Information",-1)),t("p",null,[e[17]||(e[17]=t("span",{class:"font-medium"},"Name:",-1)),v(" "+a(l.viewedClient.client_name),1)]),t("p",null,[e[18]||(e[18]=t("span",{class:"font-medium"},"Created At:",-1)),v(" "+a(R(l.viewedClient.created_at)),1)]),t("p",null,[e[19]||(e[19]=t("span",{class:"font-medium"},"Created By:",-1)),v(" "+a(l.viewedClient.created_by),1)])]),t("div",at,[e[26]||(e[26]=t("h3",{class:"font-semibold text-lg mb-2"},"Contact Persons",-1)),(o=l.viewedClient.contact_persons)!=null&&o.length?(r(),i("div",nt,[(r(!0),i(N,null,j(l.viewedClient.contact_persons,s=>(r(),i("div",{key:s.name,class:"border p-3 rounded"},[t("p",null,[e[21]||(e[21]=t("span",{class:"font-medium"},"Name:",-1)),v(" "+a(s.full_name),1)]),t("p",null,[e[22]||(e[22]=t("span",{class:"font-medium"},"Email:",-1)),v(" "+a(s.email),1)]),t("p",null,[e[23]||(e[23]=t("span",{class:"font-medium"},"Mobile:",-1)),v(" "+a(s.mobile_no||"Not specified"),1)]),t("p",null,[e[24]||(e[24]=t("span",{class:"font-medium"},"Gender:",-1)),v(" "+a(s.gender||"Not specified"),1)]),t("p",null,[e[25]||(e[25]=t("span",{class:"font-medium"},"Bio:",-1)),v(" "+a(s.bio||"Not specified"),1)])]))),128))])):(r(),i("p",rt,"No contact persons"))]),t("div",it,[e[32]||(e[32]=t("h3",{class:"font-semibold text-lg mb-2"},"Selected Users",-1)),(n=l.viewedClient.selected_users)!=null&&n.length?(r(),i("div",dt,[(r(!0),i(N,null,j(l.viewedClient.selected_users,s=>(r(),i("div",{key:s.name,class:"border p-3 rounded"},[t("p",null,[e[27]||(e[27]=t("span",{class:"font-medium"},"Name:",-1)),v(" "+a(s.full_name),1)]),t("p",null,[e[28]||(e[28]=t("span",{class:"font-medium"},"Email:",-1)),v(" "+a(s.email),1)]),t("p",null,[e[29]||(e[29]=t("span",{class:"font-medium"},"Mobile:",-1)),v(" "+a(s.mobile_no||"Not specified"),1)]),t("p",null,[e[30]||(e[30]=t("span",{class:"font-medium"},"Gender:",-1)),v(" "+a(s.gender||"Not specified"),1)]),t("p",null,[e[31]||(e[31]=t("span",{class:"font-medium"},"Bio:",-1)),v(" "+a(s.bio||"Not specified"),1)])]))),128))])):(r(),i("p",ct,"No selected users"))]),t("button",{onClick:e[3]||(e[3]=s=>l.viewModalVisible=!1),class:"mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"}," Close ")])])):D("",!0)],64)}}},vt=me(ut,[["__scopeId","data-v-de3dc7b1"]]);export{vt as default};
//# sourceMappingURL=ClientForm-CUyRzC3N.js.map
